%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
git clone  --recursive https://github.com/s-sacerdoti/atlas-altiroc-daq.git atlas-altiroc-daq-testbench
cd atlas-altiroc-daq-testbench
git checkout dev_testbench_timing_nikola

cd firmware/submodules/ruckus
git status
git checkout 74289de
cd ../../../software/

source setup_env_lal2.sh

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% firmware/submodules version
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
ruckus: HEAD detached at 74289de
surf: HEAD detached at 8f3d65fb9

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% configuration:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

For all script, the file config/asic_config_BX.yml will be used
by default for the configuration with X being the board number
A different file can be used with the following option
--cfg config/asic_config_BLABLA.yml 
Additionnal parameters are set in
see also scripts/setASICconfig.py called in all scripts

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% measurements
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Threshold scan
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
switch 18 of the IB should be OFF

python scripts/thresholdScan.py  --debug False --checkOFtoa True --checkOFtot False  --out Data/ --delay 2450 --board 2 --Cd 0  --minVth 330 --maxVth 370 --VthStep 2 --ch 5 --Q 5
python scripts/thresholdScan.py  --debug False --checkOFtoa True --checkOFtot False  --out Data/ --delay 2500 --board 8 --Cd 4  --minVth 330 --maxVth 390 --VthStep 2 --ch 4 --Q 5
python scripts/thresholdScan.py  --debug False --checkOFtoa True --checkOFtot False  --out Data/ --delay 2450 --board 18 --Cd 0  --minVth 330 --maxVth 370 --VthStep 2 --ch 0 --Q 5


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Charge scan
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
switch 18 of the IB should be OFF

python scripts/measureTimeWalk.py --debug False --N 100 --useProbePA False --useProbeDiscri False --checkOFtoa False --checkOFtot False --board 2 --Cd 0  --QMin 3 --QMax 63 --QStep 1 --out Data/  --delay 2450  --ch 5  --DAC 350
python scripts/measureTimeWalk.py --debug False --N 100 --useProbePA False --useProbeDiscri False --checkOFtoa False --checkOFtot False --board 8 --Cd 4  --QMin 3 --QMax 63 --QStep 1 --out Data/  --delay 2500  --ch 4  --DAC 350
python scripts/measureTimeWalk.py --debug False --N 100 --useProbePA False --useProbeDiscri False --checkOFtoa False --checkOFtot False --board 18 --Cd 0 --QMin 3 --QMax 63 --QStep 1 --out Data/  --delay 2450   --ch 0 --DAC 350

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Delay scan using external trigger
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
switch 18 of the IB should be ON

python scripts/measureTOA.py --N 100 --debug False --checkOFtoa True --checkOFtot False  --board 2 --ch 5 --useExt True --delayMin 1800 --delayMax 2300 --delayStep 1  --out Data/
python scripts/measureTOA.py --N 100 --debug False --checkOFtoa True --checkOFtot False  --board 8 --ch 4 --useExt True --delayMin 1800 --delayMax 2300 --delayStep 1  --out Data/
python scripts/measureTOA.py --N 100 --debug False --checkOFtoa True --checkOFtot False  --board 18 --ch 0 --useExt True --delayMin 1800 --delayMax 2300 --delayStep 1  --out Data/ 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Delay scan using pulser
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
switch 18 of the IB should be OFF

python scripts/measureTOA.py --N 100 --debug False --checkOFtoa True --checkOFtot False --ch 5  --Cd 0  --board 2 --DAC 350 --Q 26 --delayMin 2200 --delayMax 2700 --delayStep 1 --out Data/
python scripts/measureTOA.py --N 100 --debug False --checkOFtoa True --checkOFtot False --ch 4  --Cd 4  --board 8 --DAC 350 --Q 26 --delayMin 2200 --delayMax 2700 --delayStep 1 --out Data/
python scripts/measureTOA.py --N 100 --debug False --checkOFtoa True --checkOFtot False --ch 0  --Cd 0  --board 18 --DAC 350 --Q 26 --delayMin 2200 --delayMax 2700 --delayStep 1 --out Data/


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Width scan using external trigger
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
switch 18 of the IB should be ON
fallEdge is hardcoded and is equal to 3000

python scripts/measureTOT.py --N 50 --debug False --checkOFtoa False --checkOFtot True  --board 2 --ch 6 --useExt True --riseEdgeMin 700 --riseEdgeMax 3000 --riseEdgeStep 10 --out Data/
python scripts/measureTOT.py --N 50 --debug False --checkOFtoa False --checkOFtot True  --board 8 --ch 4 --useExt True --riseEdgeMin 700 --riseEdgeMax 3000 --riseEdgeStep 10 --out Data/
python scripts/measureTOT.py --N 50 --debug False --checkOFtoa False --checkOFtot True  --board 18 --ch 0 --useExt True --riseEdgeMin 700 --riseEdgeMax 3000 --riseEdgeStep 10 --out Data/




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DevGui
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

python scripts/DevGui.py --ip 192.168.1.10 --userYaml config/config_B2_ch8_probeON_pulserON.yml --liveDisplay 1

